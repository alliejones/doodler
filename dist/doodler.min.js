function Recording(){this.array=[]}function Canvas(t){this.el=document.createElement("canvas"),this.ctr=document.getElementById(t.id),this.ctx=this.el.getContext("2d"),this.ctr.appendChild(this.el),this.prevMouseCoords={x:null,y:null},this.mouseCoords={x:null,y:null},this.curMouseCoords={x:null,y:null},this.newHistory(),this.recordingLoop=null,this.recordingInterval=10,this.el.width=t.width,this.el.height=t.height,this.ctx.lineCap="round",this.ctx.lineJoin="round",this.ctx.strokeStyle="black",t.readOnly||(this.ctr.addEventListener("mousedown",this._onMousedown.bind(this)),window.addEventListener("selectstart",function(){return!1}),window.addEventListener("mousemove",this._onMousemove.bind(this)),window.addEventListener("mouseup",this._onMouseup.bind(this)))}Recording.prototype.fromJSON=function(t){for(var o=JSON.parse(t),e=0,i=o.length;i>e;e++)this.append(o[e])},Recording.prototype.append=function(t){this.array.push(t)},Recording.prototype.toJSON=function(){return this.array},Recording.prototype.forEachTimeout=function(t,o){0!==this.array.length&&this._eachElTimeout(0,t,o)},Recording.prototype._eachElTimeout=function(t,o,e){o(this.array[t]),this.array.length>t+1&&window.setTimeout(function(){this._eachElTimeout(t+1,o,e)}.bind(this),e)},Canvas.prototype._mapCoords=function(t,o){var e=this.el.getBoundingClientRect();return{x:t-e.left*(this.el.width/e.width),y:o-e.top*(this.el.height/e.height)}},Canvas.prototype._onMousedown=function(t){this._startDrawing(t)},Canvas.prototype._onMouseup=function(){this._stopDrawing()},Canvas.prototype._onMousemove=function(t){var o=this._windowScrollPosition();this.curMouseCoords=this._mapCoords(t.pageX-o.left,t.pageY-o.top)},Canvas.prototype._windowScrollPosition=function(){var t=document.documentElement,o=document.body,e=t&&t.scrollLeft||o&&o.scrollLeft||0,i=t&&t.scrollTop||o&&o.scrollTop||0;return{left:e,top:i}},Canvas.prototype.replay=function(){this.recording.forEachTimeout(function(t){this.setStrokeColor(t[2][0]),this.setStrokeWidth(t[2][1]),this["_"+t[0]].apply(this,t[1])}.bind(this),this.recordingInterval)},Canvas.prototype._startDrawing=function(t){var o=this._mapCoords(t.pageX,t.pageY);this.recordingLoop=window.setInterval(this._draw.bind(this),this.recordingInterval),this.ctx.moveTo(o.x,o.y),this.ctx.beginPath()},Canvas.prototype._stopDrawing=function(){this.ctx.beginPath(),this.prevMouseCoords={x:null,y:null},this.mouseCoords={x:null,y:null},window.clearInterval(this.recordingLoop),this.recordingLoop=null},Canvas.prototype.setStrokeColor=function(t){this.ctx.strokeStyle=t},Canvas.prototype.setStrokeWidth=function(t){this.ctx.lineWidth=t},Canvas.prototype._draw=function(){var t=this.prevMouseCoords.x=this.mouseCoords.x,o=this.prevMouseCoords.y=this.mouseCoords.y,e=this.mouseCoords.x=this.curMouseCoords.x,i=this.mouseCoords.y=this.curMouseCoords.y;(null===t||null===o)&&(t=e,o=i),this.line(t,o,e,i)},Canvas.prototype.line=function(t,o,e,i){this.recording.append(["line",[Math.floor(t),Math.floor(o),Math.floor(e),Math.floor(i)],[this.ctx.strokeStyle,this.ctx.lineWidth]]),this._line(t,o,e,i)},Canvas.prototype._line=function(t,o,e,i){this.ctx.beginPath(),this.ctx.moveTo(t,o),this.ctx.lineTo(e,i),this.ctx.stroke()},Canvas.prototype.translate=function(t,o){this.ctx.save(),this.ctx.translate(t,o)},Canvas.prototype.undoTranslate=function(){this.ctx.restore()},Canvas.prototype.newHistory=function(){this.recording=new Recording},Canvas.prototype.erase=function(){this.ctx.clearRect(0,0,this.el.width,this.el.height)},Canvas.prototype.fromJSON=function(t){this.recording.fromJSON(t)};