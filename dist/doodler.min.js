function Node(t){return{data:t,next:null}}function LinkedList(){this.head=null,this.tail=null,this.size=0}function Canvas(t){this.el=document.createElement("canvas"),this.ctr=document.getElementById(t.id),this.ctx=this.el.getContext("2d"),this.ctr.appendChild(this.el),this.prevMouseCoords={x:null,y:null},this.mouseCoords={x:null,y:null},this.curMouseCoords={x:null,y:null},this.recordingLoop=null,this.recording=new LinkedList,this.recordingInterval=10,this.el.width=t.width,this.el.height=t.height,this.ctx.lineCap="round",this.ctx.lineJoin="round",this.ctx.strokeStyle="black",t.readOnly||(this.ctr.addEventListener("mousedown",this._onMousedown.bind(this)),window.addEventListener("selectstart",function(){return!1}),window.addEventListener("mousemove",this._onMousemove.bind(this)),window.addEventListener("mouseup",this._onMouseup.bind(this)))}LinkedList.prototype.fromJSON=function(t){for(var o=JSON.parse(t),n=0,e=o.length;e>n;n++)this.append(o[n])},LinkedList.prototype.prepend=function(t){var o=new Node(t);o.next=this.head,this.head=o,this.size+=1},LinkedList.prototype.append=function(t){var o=new Node(t);this.head?this.tail.next=o:(this.head=o,this.tail=o),this.tail=o,this.size+=1},LinkedList.prototype.print=function(){for(var t=this.head,o=[];t;)o.push(t.data),t=t.next;return o.join(", ")},LinkedList.prototype.toJSON=function(){for(var t=this.head,o=[];t;)o.push(t.data),t=t.next;return o},Canvas.prototype._mapCoords=function(t,o){var n=this.el.getBoundingClientRect();return{x:t-n.left*(this.el.width/n.width),y:o-n.top*(this.el.height/n.height)}},Canvas.prototype._onMousedown=function(t){this._startDrawing(t)},Canvas.prototype._onMouseup=function(){this._stopDrawing()},Canvas.prototype._onMousemove=function(t){var o=this._windowScrollPosition();this.curMouseCoords=this._mapCoords(t.pageX-o.left,t.pageY-o.top)},Canvas.prototype._windowScrollPosition=function(){var t=document.documentElement,o=document.body,n=t&&t.scrollLeft||o&&o.scrollLeft||0,e=t&&t.scrollTop||o&&o.scrollTop||0;return{left:n,top:e}},Canvas.prototype.replay=function(){this._redraw(this.recording.head)},Canvas.prototype._redraw=function(t){this.setStrokeColor(t.data[2][0]),this.setStrokeWidth(t.data[2][1]),this["_"+t.data[0]].apply(this,t.data[1]),t.next?window.setTimeout(function(){this._redraw(t.next)}.bind(this),this.recordingInterval):this.ctx.beginPath()},Canvas.prototype._startDrawing=function(t){var o=this._mapCoords(t.pageX,t.pageY);this.recordingLoop=window.setInterval(this._draw.bind(this),this.recordingInterval),this.ctx.moveTo(o.x,o.y),this.ctx.beginPath()},Canvas.prototype._stopDrawing=function(){this.ctx.beginPath(),this.prevMouseCoords={x:null,y:null},this.mouseCoords={x:null,y:null},window.clearInterval(this.recordingLoop),this.recordingLoop=null},Canvas.prototype.setStrokeColor=function(t){this.ctx.strokeStyle=t},Canvas.prototype.setStrokeWidth=function(t){this.ctx.lineWidth=t},Canvas.prototype._draw=function(){var t=this.prevMouseCoords.x=this.mouseCoords.x,o=this.prevMouseCoords.y=this.mouseCoords.y,n=this.mouseCoords.x=this.curMouseCoords.x,e=this.mouseCoords.y=this.curMouseCoords.y;(null===t||null===o)&&(t=n,o=e),this.line(t,o,n,e)},Canvas.prototype.line=function(t,o,n,e){this.recording.append(["line",[Math.floor(t),Math.floor(o),Math.floor(n),Math.floor(e)],[this.ctx.strokeStyle,this.ctx.lineWidth]]),this._line(t,o,n,e)},Canvas.prototype._line=function(t,o,n,e){this.ctx.beginPath(),this.ctx.moveTo(t,o),this.ctx.lineTo(n,e),this.ctx.stroke()},Canvas.prototype.translate=function(t,o){this.recording.append(["translate",[t,o],[]]),this._translate(t,o)},Canvas.prototype._translate=function(t,o){this.ctx.save(),this.ctx.translate(t,o)},Canvas.prototype.undoTranslation=function(){this.recording.append(["clearTranslation",[],[]]),this._clearTranslation()},Canvas.prototype._undoTranslation=function(){this.ctx.restore()},Canvas.prototype.clearHistory=function(){this.recording=new LinkedList},Canvas.prototype.erase=function(){this.ctx.clearRect(0,0,this.el.width,this.el.height)},Canvas.prototype.fromJSON=function(t){this.recording.fromJSON(t)};